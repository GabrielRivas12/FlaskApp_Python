{% extends "baseadmin.html" %}

{% block titulo %} Gesti√≥n de Destinos {% endblock titulo %}

{% block body %}

<!--MENSAJE DE ALERTA SweetAlert2 CONFIRMACION-->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class=flashes>
    {% for category, message in messages %}
    <script type="text/javascript">
        const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 2000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.onmouseenter = Swal.stopTimer;
                toast.onmouseleave = Swal.resumeTimer;
            }
        });
        Toast.fire({
            icon: "success",
            title: "{{message}}"
        });
    </script>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}

<div class="container mt-4">

    <!-- Encabezado -->
    <div class="rounded-3 p-4 mb-4 shadow-sm text-white text-center"
        style="background: linear-gradient(140deg, #007bff, #17a2b8, #138496);">
        <h2 class="mb-0"><i class="fas fa-map-marked-alt me-2"></i>Gesti√≥n de Destinos Tur√≠sticos</h2>
    </div>

    <!-- Contenedor para herramientas -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body" style="background-color: #e8f4f8;">
            <div class="row align-items-center">
                <!-- Botones de Exportaci√≥n -->
                <div class="col-md-6">
                    <div class="btn-group" role="group">
                        <button id="btnCopiar" class="btn btn-outline-primary btn-sm" title="Copiar">
                            <i class="fas fa-copy me-1"></i>Copiar
                        </button>
                        <button id="btnExcel" class="btn btn-outline-success btn-sm" title="Exportar a Excel">
                            <i class="fas fa-file-excel me-1"></i>Excel
                        </button>
                        <button id="btnPDF" class="btn btn-outline-danger btn-sm" title="Exportar a PDF">
                            <i class="fas fa-file-pdf me-1"></i>PDF
                        </button>
                        <button id="btnImprimir" class="btn btn-outline-secondary btn-sm" title="Imprimir">
                            <i class="fas fa-print me-1"></i>Imprimir
                        </button>
                    </div>
                </div>

                <!-- Buscador y filtros -->
                <div class="col-md-6">
                    <div class="d-flex justify-content-end gap-2">
                        <!-- Combo Box para seleccionar cantidad por p√°gina -->
                        <form method="GET" action="{{ url_for('productos') }}" class="d-flex align-items-center">
                            <label for="por_pagina" class="form-label mb-0 me-2 small fw-semibold"
                                style="color: #007bff;">Mostrar:</label>
                            <select name="por_pagina" id="por_pagina" class="form-select form-select-sm border-primary"
                                style="width: 80px;" onchange="this.form.submit()">
                                <option value="5" {% if request.args.get('por_pagina', '5')=='5' %}selected{% endif %}>5</option>
                                <option value="10" {% if request.args.get('por_pagina', '5')=='10' %}selected{% endif %}>10</option>
                                <option value="25" {% if request.args.get('por_pagina', '5')=='25' %}selected{% endif %}>25</option>
                                <option value="50" {% if request.args.get('por_pagina', '5')=='50' %}selected{% endif %}>50</option>
                                <option value="100" {% if request.args.get('por_pagina', '5')=='100' %}selected{% endif %}>100</option>
                            </select>
                            <!-- Mantener el par√°metro de b√∫squeda si existe -->
                            {% if request.args.get('buscar') %}
                            <input type="hidden" name="buscar" value="{{ request.args.get('buscar') }}">
                            {% endif %}
                        </form>

                        <!-- Buscador -->
                        <form method="GET" action="{{ url_for('productos') }}" class="d-flex">
                            <div class="input-group input-group-sm">
                                <input type="text" class="form-control border-primary" id="buscar" name="buscar"
                                    value="{{ request.args.get('buscar', '') }}" placeholder="Buscar destino..."
                                    style="width: 200px;">
                                <button type="submit" class="btn text-white" style="background-color: #007bff;">
                                    <i class="fas fa-search"></i>
                                </button>
                                {% if request.args.get('buscar') %}
                                <a href="{{ url_for('productos') }}" class="btn btn-outline-danger" title="Limpiar filtro">
                                    <i class="fas fa-times"></i>
                                </a>
                                {% endif %}
                            </div>
                            <!-- Mantener el par√°metro de cantidad por p√°gina si existe -->
                            {% if request.args.get('por_pagina') %}
                            <input type="hidden" name="por_pagina" value="{{ request.args.get('por_pagina') }}">
                            {% endif %}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de Destinos -->
    <div class="card border-0 shadow-sm">
        <div class="card-header text-white rounded-top-3 py-3 d-flex justify-content-between align-items-center"
            style="background: linear-gradient(90deg, #007bff, #17a2b8);">
            <h5 class="mb-0"><i class="fas fa-list me-2"></i>Lista de Destinos Registrados</h5>
            <!-- Bot√≥n para agregar nuevo destino -->
            <button class="btn btn-light btn-sm fw-bold" data-bs-toggle="modal" data-bs-target="#agregarModal">
                <i class="fas fa-plus me-1"></i>Nuevo Destino
            </button>
        </div>
        <div class="table-responsive">
            <table id="tablaDestinos" class="table table-hover align-middle mb-0">
                <thead class="text-white" style="background: linear-gradient(90deg, #138496, #17a2b8);">
                    <tr>
                        <th class="text-center" style="width: 60px;">
                            <i class="fas fa-hashtag me-1"></i>ID
                        </th>
                        <th style="width: 20%;">
                            <i class="fas fa-map-pin me-1"></i>Destino
                        </th>
                        <th class="text-center" style="width: 120px;">
                            <i class="fas fa-plane-departure me-1"></i>Origen
                        </th>
                        <th class="text-center" style="width: 120px;">
                            <i class="fas fa-plane-arrival me-1"></i>Destino
                        </th>
                        <th class="text-center" style="width: 150px;">
                            <i class="fas fa-plane me-1"></i>Aerol√≠nea
                        </th>
                        <th class="text-center" style="width: 100px;">
                            <i class="fas fa-dollar-sign me-1"></i>Precio
                        </th>
                        <th class="text-center" style="width: 120px;">
                            <i class="fas fa-calendar-alt me-1"></i>Salida
                        </th>
                        <th class="text-center" style="width: 120px;">
                            <i class="fas fa-calendar-check me-1"></i>Regreso
                        </th>
                        <th class="text-center" style="width: 120px;">
                            <i class="fas fa-calendar-plus me-1"></i>Fecha Registro
                        </th>
                        <th class="text-center" style="width: 140px;">
                            <i class="fas fa-cogs me-1"></i>Acciones
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% if productos is iterable %}
                        {% for producto in productos %}
                        <tr style="background-color: #f8f9fa;">
                            <td class="text-center fw-bold">{{ producto.id }}</td>
                            <td>
                                <div class="fw-semibold">{{ producto.nombre }}</div>
                                {% if producto.descripcion %}
                                <small class="text-muted">{{ producto.descripcion[:50] }}{% if producto.descripcion|length > 50 %}...{% endif %}</small>
                                {% endif %}
                            </td>
                            <td class="text-center">{{ producto.origen }}</td>
                            <td class="text-center">{{ producto.destino }}</td>
                            <td class="text-center">{{ producto.aerolinea }}</td>
                            <td class="text-center fw-bold text-success">${{ "%.2f"|format(producto.precio) }}</td>
                            <td class="text-center">{{ producto.fecha_salida }}</td>
                            <td class="text-center">{{ producto.fecha_regreso }}</td>
                            <td class="text-center">{{ producto.FechaRegistro.strftime('%d/%m/%Y') if producto.FechaRegistro else 'N/A' }}</td>
                            <td class="text-center">
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-primary btn-editar" data-bs-toggle="modal"
                                        data-bs-target="#editarModal" data-id="{{ producto.id }}"
                                        data-nombre="{{ producto.nombre }}" data-precio="{{ producto.precio }}"
                                        data-descripcion="{{ producto.descripcion or '' }}"
                                        data-origen="{{ producto.origen }}" data-destino="{{ producto.destino }}"
                                        data-fecha-salida="{{ producto.fecha_salida }}"
                                        data-fecha-regreso="{{ producto.fecha_regreso }}"
                                        data-aerolinea="{{ producto.aerolinea }}" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-eliminar"
                                        data-url="{{ url_for('eliminar_producto', id=producto.id) }}"
                                        data-nombre="{{ producto.nombre }}" title="Eliminar destino">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        {% for producto in productos.items %}
                        <tr style="background-color: #f8f9fa;">
                            <td class="text-center fw-bold">{{ producto.id }}</td>
                            <td>
                                <div class="fw-semibold">{{ producto.nombre }}</div>
                                {% if producto.descripcion %}
                                <small class="text-muted">{{ producto.descripcion[:50] }}{% if producto.descripcion|length > 50 %}...{% endif %}</small>
                                {% endif %}
                            </td>
                            <td class="text-center">{{ producto.origen }}</td>
                            <td class="text-center">{{ producto.destino }}</td>
                            <td class="text-center">{{ producto.aerolinea }}</td>
                            <td class="text-center fw-bold text-success">${{ "%.2f"|format(producto.precio) }}</td>
                            <td class="text-center">{{ producto.fecha_salida }}</td>
                            <td class="text-center">{{ producto.fecha_regreso }}</td>
                            <td class="text-center">{{ producto.FechaRegistro.strftime('%d/%m/%Y') if producto.FechaRegistro else 'N/A' }}</td>
                            <td class="text-center">
                                <div class="btn-group btn-group-sm" role="group">
                                    <button class="btn btn-outline-primary btn-editar" data-bs-toggle="modal"
                                        data-bs-target="#editarModal" data-id="{{ producto.id }}"
                                        data-nombre="{{ producto.nombre }}" data-precio="{{ producto.precio }}"
                                        data-descripcion="{{ producto.descripcion or '' }}"
                                        data-origen="{{ producto.origen }}" data-destino="{{ producto.destino }}"
                                        data-fecha-salida="{{ producto.fecha_salida }}"
                                        data-fecha-regreso="{{ producto.fecha_regreso }}"
                                        data-aerolinea="{{ producto.aerolinea }}" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline-danger btn-eliminar"
                                        data-url="{{ url_for('eliminar_producto', id=producto.id) }}"
                                        data-nombre="{{ producto.nombre }}" title="Eliminar destino">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Informaci√≥n de resultados -->
    {% if request.args.get('buscar') %}
    <div class="alert alert-info mt-3 py-2 border-0 shadow-sm"
        style="background-color: #e8f4f8; border-left: 4px solid #17a2b8;">
        <small class="d-flex justify-content-between align-items-center">
            <span>
                <i class="fas fa-search me-1"></i>Resultados para: "<strong>{{ request.args.get('buscar') }}</strong>"
            </span>
            <span>
                {% if productos is iterable %}
                    P√°gina <strong>1</strong> de <strong>1</strong>
                {% else %}
                    P√°gina <strong>{{ productos.page }}</strong> de <strong>{{ productos.pages }}</strong>
                {% endif %}
            </span>
        </small>
    </div>
    {% else %}
    <div class="alert alert-info mt-3 py-2 border-0 shadow-sm"
        style="background-color: #e8f4f8; border-left: 4px solid #17a2b8;">
        <small class="d-flex justify-content-between align-items-center">
            <span>
                <i class="fas fa-chart-bar me-1"></i>
                {% if productos is iterable %}
                    Mostrando <strong>{{ productos|length }}</strong> de <strong>{{ productos|length }}</strong> destinos
                {% else %}
                    Mostrando <strong>{{ productos.items|length }}</strong> de <strong>{{ productos.total }}</strong> destinos
                {% endif %}
            </span>
            <span>
                {% if productos is iterable %}
                    P√°gina <strong>1</strong> de <strong>1</strong>
                {% else %}
                    P√°gina <strong>{{ productos.page }}</strong> de <strong>{{ productos.pages }}</strong>
                {% endif %}
            </span>
        </small>
    </div>
    {% endif %}

    <!-- Paginador -->
    {% if not (productos is iterable) and productos.pages > 1 %}
    <nav aria-label="Paginaci√≥n de destinos" class="mt-3">
        <ul class="pagination justify-content-center">
            <!-- Bot√≥n Anterior -->
            <li class="page-item {% if not productos.has_prev %}disabled{% endif %}">
                <a class="page-link border-primary text-primary"
                    href="{{ url_for('productos', page=productos.prev_num, buscar=request.args.get('buscar', ''), por_pagina=request.args.get('por_pagina', '5')) }}"
                    aria-label="Anterior">
                    <i class="fas fa-chevron-left"></i>
                </a>
            </li>

            <!-- P√°ginas -->
            {% for page_num in productos.iter_pages(left_edge=2, left_current=2, right_current=3, right_edge=2) %}
            {% if page_num %}
            <li class="page-item {% if page_num == productos.page %}active{% endif %}">
                <a class="page-link {% if page_num == productos.page %}text-white{% else %}text-primary{% endif %} border-primary"
                    {% if page_num==productos.page %}style="background: linear-gradient(90deg, #007bff, #17a2b8); border-color: #007bff;" {% endif %}
                    href="{{ url_for('productos', page=page_num, buscar=request.args.get('buscar', ''), por_pagina=request.args.get('por_pagina', '5')) }}">
                    {{ page_num }}
                </a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link border-primary text-muted">...</span>
            </li>
            {% endif %}
            {% endfor %}

            <!-- Bot√≥n Siguiente -->
            <li class="page-item {% if not productos.has_next %}disabled{% endif %}">
                <a class="page-link border-primary text-primary"
                    href="{{ url_for('productos', page=productos.next_num, buscar=request.args.get('buscar', ''), por_pagina=request.args.get('por_pagina', '5')) }}"
                    aria-label="Siguiente">
                    <i class="fas fa-chevron-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>

<!-- Modal para agregar destino -->
<div class="modal fade" id="agregarModal" tabindex="-1" aria-labelledby="agregarModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content border-0 shadow">
            <form method="POST" action="{{ url_for('agregar_producto') }}">
                <div class="modal-header text-white rounded-top-3"
                    style="background: linear-gradient(90deg, #28a745, #20c997);">
                    <h5 class="modal-title" id="agregarModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>Agregar Nuevo Destino
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" style="background-color: #f8f9fa;">
                    <!-- Nombre del Destino -->
                    <div class="mb-3">
                        <label for="nombre" class="form-label fw-semibold" style="color: #007bff;">
                            <i class="fas fa-map-pin me-2"></i>Nombre del Destino
                        </label>
                        <div class="input-group">
                            <span class="input-group-text" style="background-color: #e8f4f8; border-color: #17a2b8;">
                                <i class="fas fa-signature" style="color: #007bff;"></i>
                            </span>
                            <input type="text" class="form-control border-primary" name="nombre" id="nombre"
                                placeholder="Ej: Playa del Carmen, Machu Picchu..." required>
                        </div>
                        <div class="form-text text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Nombre comercial del paquete tur√≠stico
                        </div>
                    </div>

                    <!-- Precio -->
                    <div class="mb-3">
                        <label for="precio" class="form-label fw-semibold" style="color: #007bff;">
                            <i class="fas fa-dollar-sign me-2"></i>Precio por Persona
                        </label>
                        <div class="input-group">
                            <span class="input-group-text" style="background-color: #e8f4f8; border-color: #17a2b8;">
                                <i class="fas fa-tag" style="color: #007bff;"></i>
                            </span>
                            <input type="number" step="0.01" class="form-control border-primary" name="precio" id="precio" 
                                placeholder="0.00" min="0" required>
                            <span class="input-group-text"
                                style="background-color: #e8f4f8; border-color: #17a2b8;">USD</span>
                        </div>
                        <div class="form-text text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Precio total por persona en d√≥lares
                        </div>
                    </div>

                    <!-- Origen y Destino -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="origen" class="form-label fw-semibold" style="color: #007bff;">
                                    <i class="fas fa-plane-departure me-2"></i>Ciudad de Origen
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"
                                        style="background-color: #e8f4f8; border-color: #17a2b8;">
                                        <i class="fas fa-location-arrow" style="color: #007bff;"></i>
                                    </span>
                                    <input type="text" class="form-control border-primary" name="origen" id="origen"
                                        placeholder="Ej: Ciudad de M√©xico" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>Ciudad de salida del vuelo
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="destino" class="form-label fw-semibold" style="color: #007bff;">
                                    <i class="fas fa-plane-arrival me-2"></i>Ciudad de Destino
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"
                                        style="background-color: #e8f4f8; border-color: #17a2b8;">
                                        <i class="fas fa-map-marker-alt" style="color: #007bff;"></i>
                                    </span>
                                    <input type="text" class="form-control border-primary" name="destino" id="destino" 
                                        placeholder="Ej: Canc√∫n" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>Ciudad de llegada del vuelo
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fechas -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="fecha_salida" class="form-label fw-semibold" style="color: #007bff;">
                                    <i class="fas fa-calendar-alt me-2"></i>Fecha de Salida
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"
                                        style="background-color: #e8f4f8; border-color: #17a2b8;">
                                        <i class="fas fa-paper-plane" style="color: #007bff;"></i>
                                    </span>
                                    <input type="date" class="form-control border-primary" name="fecha_salida" id="fecha_salida" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>Fecha de inicio del viaje
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="fecha_regreso" class="form-label fw-semibold" style="color: #007bff;">
                                    <i class="fas fa-calendar-alt me-2"></i>Fecha de Regreso
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"
                                        style="background-color: #e8f4f8; border-color: #17a2b8;">
                                        <i class="fas fa-home" style="color: #007bff;"></i>
                                    </span>
                                    <input type="date" class="form-control border-primary" name="fecha_regreso" id="fecha_regreso" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>Fecha de regreso del viaje
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aerol√≠nea -->
                    <div class="mb-3">
                        <label for="aerolinea" class="form-label fw-semibold" style="color: #007bff;">
                            <i class="fas fa-plane me-2"></i>Aerol√≠nea
                        </label>
                        <div class="input-group">
                            <span class="input-group-text" style="background-color: #e8f4f8; border-color: #17a2b8;">
                                <i class="fas fa-building" style="color: #007bff;"></i>
                            </span>
                            <input type="text" class="form-control border-primary" name="aerolinea" id="aerolinea"
                                placeholder="Ej: Aerom√©xico, Volaris..." required>
                        </div>
                        <div class="form-text text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Compa√±√≠a a√©rea del vuelo
                        </div>
                    </div>

                    <!-- Descripci√≥n -->
                    <div class="mb-4">
                        <label for="descripcion" class="form-label fw-semibold" style="color: #007bff;">
                            <i class="fas fa-info-circle me-2"></i>Descripci√≥n del Destino
                        </label>
                        <div class="input-group">
                            <span class="input-group-text align-items-start"
                                style="background-color: #e8f4f8; border-color: #17a2b8; padding-top: 12px;">
                                <i class="fas fa-comment" style="color: #007bff;"></i>
                            </span>
                            <textarea class="form-control border-primary" name="descripcion" id="descripcion" rows="4"
                                placeholder="Describe las atracciones, actividades y caracter√≠sticas √∫nicas de este destino..."></textarea>
                        </div>
                        <div class="form-text text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Descripci√≥n detallada del paquete tur√≠stico
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="background-color: #e8f4f8;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="submit" class="btn text-white fw-bold"
                        style="background: linear-gradient(90deg, #28a745, #20c997); border: none;">
                        <i class="fas fa-plus-circle me-2"></i>Agregar Destino
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para editar destino -->
<div class="modal fade" id="editarModal" tabindex="-1" aria-labelledby="editarModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content border-0 shadow">
            <form method="POST" action="" id="form-editar">
                <div class="modal-header text-white rounded-top-3"
                    style="background: linear-gradient(90deg, #007bff, #17a2b8);">
                    <h5 class="modal-title" id="editarModalLabel">
                        <i class="fas fa-edit me-2"></i>Editar Destino
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" style="background-color: #f8f9fa;">
                    <input type="hidden" name="producto_id" id="modal_producto_id">

                    <!-- Nombre del Destino -->
                    <div class="mb-3">
                        <label for="modal_nombre" class="form-label fw-semibold" style="color: #007bff;">
                            <i class="fas fa-map-pin me-2"></i>Nombre del Destino
                        </label>
                        <div class="input-group">
                            <span class="input-group-text" style="background-color: #e8f4f8; border-color: #17a2b8;">
                                <i class="fas fa-signature" style="color: #007bff;"></i>
                            </span>
                            <input type="text" class="form-control border-primary" name="nombre" id="modal_nombre"
                                placeholder="Ej: Playa del Carmen, Machu Picchu..." required>
                        </div>
                        <div class="form-text text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Nombre comercial del paquete tur√≠stico
                        </div>
                    </div>

                    <!-- Precio -->
                    <div class="mb-3">
                        <label for="modal_precio" class="form-label fw-semibold" style="color: #007bff;">
                            <i class="fas fa-dollar-sign me-2"></i>Precio por Persona
                        </label>
                        <div class="input-group">
                            <span class="input-group-text" style="background-color: #e8f4f8; border-color: #17a2b8;">
                                <i class="fas fa-tag" style="color: #007bff;"></i>
                            </span>
                            <input type="number" step="0.01" class="form-control border-primary" name="precio" id="modal_precio"
                                placeholder="0.00" min="0" required>
                            <span class="input-group-text"
                                style="background-color: #e8f4f8; border-color: #17a2b8;">USD</span>
                        </div>
                        <div class="form-text text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Precio total por persona en d√≥lares
                        </div>
                    </div>

                    <!-- Origen y Destino -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modal_origen" class="form-label fw-semibold" style="color: #007bff;">
                                    <i class="fas fa-plane-departure me-2"></i>Ciudad de Origen
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"
                                        style="background-color: #e8f4f8; border-color: #17a2b8;">
                                        <i class="fas fa-location-arrow" style="color: #007bff;"></i>
                                    </span>
                                    <input type="text" class="form-control border-primary" name="origen" id="modal_origen"
                                        placeholder="Ej: Ciudad de M√©xico" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>Ciudad de salida del vuelo
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modal_destino" class="form-label fw-semibold" style="color: #007bff;">
                                    <i class="fas fa-plane-arrival me-2"></i>Ciudad de Destino
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"
                                        style="background-color: #e8f4f8; border-color: #17a2b8;">
                                        <i class="fas fa-map-marker-alt" style="color: #007bff;"></i>
                                    </span>
                                    <input type="text" class="form-control border-primary" name="destino" id="modal_destino"
                                        placeholder="Ej: Canc√∫n" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>Ciudad de llegada del vuelo
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fechas -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modal_fecha_salida" class="form-label fw-semibold" style="color: #007bff;">
                                    <i class="fas fa-calendar-alt me-2"></i>Fecha de Salida
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"
                                        style="background-color: #e8f4f8; border-color: #17a2b8;">
                                        <i class="fas fa-paper-plane" style="color: #007bff;"></i>
                                    </span>
                                    <input type="date" class="form-control border-primary" name="fecha_salida" id="modal_fecha_salida" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>Fecha de inicio del viaje
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="modal_fecha_regreso" class="form-label fw-semibold" style="color: #007bff;">
                                    <i class="fas fa-calendar-alt me-2"></i>Fecha de Regreso
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"
                                        style="background-color: #e8f4f8; border-color: #17a2b8;">
                                        <i class="fas fa-home" style="color: #007bff;"></i>
                                    </span>
                                    <input type="date" class="form-control border-primary" name="fecha_regreso"
                                        id="modal_fecha_regreso" required>
                                </div>
                                <div class="form-text text-muted small">
                                    <i class="fas fa-info-circle me-1"></i>Fecha de regreso del viaje
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Aerol√≠nea -->
                    <div class="mb-3">
                        <label for="modal_aerolinea" class="form-label fw-semibold" style="color: #007bff;">
                            <i class="fas fa-plane me-2"></i>Aerol√≠nea
                        </label>
                        <div class="input-group">
                            <span class="input-group-text" style="background-color: #e8f4f8; border-color: #17a2b8;">
                                <i class="fas fa-building" style="color: #007bff;"></i>
                            </span>
                            <input type="text" class="form-control border-primary" name="aerolinea" id="modal_aerolinea"
                                placeholder="Ej: Aerom√©xico, Volaris..." required>
                        </div>
                        <div class="form-text text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Compa√±√≠a a√©rea del vuelo
                        </div>
                    </div>

                    <!-- Descripci√≥n -->
                    <div class="mb-4">
                        <label for="modal_descripcion" class="form-label fw-semibold" style="color: #007bff;">
                            <i class="fas fa-info-circle me-2"></i>Descripci√≥n del Destino
                        </label>
                        <div class="input-group">
                            <span class="input-group-text align-items-start"
                                style="background-color: #e8f4f8; border-color: #17a2b8; padding-top: 12px;">
                                <i class="fas fa-comment" style="color: #007bff;"></i>
                            </span>
                            <textarea class="form-control border-primary" name="descripcion" id="modal_descripcion" rows="4"
                                placeholder="Describe las atracciones, actividades y caracter√≠sticas √∫nicas de este destino..."></textarea>
                        </div>
                        <div class="form-text text-muted small">
                            <i class="fas fa-info-circle me-1"></i>Descripci√≥n detallada del paquete tur√≠stico
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="background-color: #e8f4f8;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="submit" class="btn text-white fw-bold"
                        style="background: linear-gradient(90deg, #28a745, #20c997); border: none;">
                        <i class="fas fa-save me-1"></i>Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tabla = document.getElementById("tablaDestinos");

        // üìã COPIAR
        document.getElementById("btnCopiar").addEventListener("click", function () {
            let texto = "";
            tabla.querySelectorAll("tr").forEach(fila => {
                const celdas = Array.from(fila.querySelectorAll("th, td"))
                    .map(td => td.innerText.trim())
                    .filter((_, index) => index !== 9); // Excluir columna de acciones
                texto += celdas.join("\t") + "\n";
            });

            navigator.clipboard.writeText(texto).then(() => {
                Swal.fire({
                    title: '¬°Copiado!',
                    text: 'La tabla ha sido copiada al portapapeles',
                    icon: 'success',
                    timer: 1500,
                    showConfirmButton: false
                });
            }).catch(err => {
                console.error('Error al copiar: ', err);
                Swal.fire('Error', 'No se pudo copiar la tabla', 'error');
            });
        });

        // üìä EXPORTAR A EXCEL
        document.getElementById("btnExcel").addEventListener("click", function () {
            // Clonar la tabla para eliminar la columna de acciones
            const tablaClonada = tabla.cloneNode(true);
            tablaClonada.querySelectorAll('tr').forEach(fila => {
                const celdas = fila.querySelectorAll('th, td');
                if (celdas.length > 9) {
                    celdas[9].remove(); // Eliminar columna de acciones
                }
            });

            const wb = XLSX.utils.table_to_book(tablaClonada, { sheet: "Destinos" });
            XLSX.writeFile(wb, "destinos_turisticos.xlsx");

            Swal.fire({
                title: '¬°Exportado!',
                text: 'Los destinos han sido exportados a Excel',
                icon: 'success',
                timer: 1500,
                showConfirmButton: false
            });
        });

        // üìÑ EXPORTAR A PDF
        document.getElementById("btnPDF").addEventListener("click", function () {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFillColor(0, 123, 255);
            doc.rect(0, 0, 210, 15, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(16);
            doc.text("Lista de Destinos Tur√≠sticos", 105, 10, { align: 'center' });

            // Preparar datos excluyendo la columna de acciones
            const headers = [];
            const rows = [];

            // Encabezados (excluyendo "Acciones")
            tabla.querySelectorAll('thead th').forEach((th, index) => {
                if (index !== 9) { // Excluir columna de acciones
                    headers.push(th.innerText);
                }
            });

            // Filas de datos
            tabla.querySelectorAll('tbody tr').forEach(tr => {
                const row = [];
                tr.querySelectorAll('td').forEach((td, index) => {
                    if (index !== 9) { // Excluir columna de acciones
                        row.push(td.innerText);
                    }
                });
                rows.push(row);
            });

            doc.autoTable({
                head: [headers],
                body: rows,
                startY: 25,
                styles: { fontSize: 8 },
                headStyles: {
                    fillColor: [23, 162, 184],
                    textColor: 255
                },
                alternateRowStyles: {
                    fillColor: [248, 249, 250]
                }
            });

            doc.save("destinos_turisticos.pdf");

            Swal.fire({
                title: '¬°Exportado!',
                text: 'Los destinos han sido exportados a PDF',
                icon: 'success',
                timer: 1500,
                showConfirmButton: false
            });
        });

        // üñ®Ô∏è IMPRIMIR
        document.getElementById("btnImprimir").addEventListener("click", function () {
            const printWindow = window.open("", "_blank");
            const tablaClonada = tabla.cloneNode(true);

            // Remover columna de acciones para impresi√≥n
            tablaClonada.querySelectorAll('tr').forEach(fila => {
                const celdas = fila.querySelectorAll('th, td');
                if (celdas.length > 9) {
                    celdas[9].remove();
                }
            });

            printWindow.document.write(`
            <html>
                <head>
                    <title>Lista de Destinos Tur√≠sticos</title>
                    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
                    <style>
                        body { padding: 20px; font-family: Arial, sans-serif; }
                        h2 { color: #007bff; margin-bottom: 20px; text-align: center; }
                        .table { width: 100%; border-collapse: collapse; font-size: 12px; }
                        .table th { background: linear-gradient(90deg, #007bff, #17a2b8); color: white; padding: 8px; }
                        .table td { padding: 6px; border-bottom: 1px solid #dee2e6; }
                        .badge { padding: 3px 6px; border-radius: 4px; font-size: 11px; }
                        @media print {
                            .table { font-size: 10px; }
                            body { margin: 0; padding: 10px; }
                        }
                    </style>
                </head>
                <body>
                    <h2><i class="fas fa-map-marked-alt me-2"></i>Lista de Destinos Tur√≠sticos</h2>
                    ${tablaClonada.outerHTML}
                    <script>
                        window.onload = function() { 
                            window.print(); 
                            setTimeout(function() { window.close(); }, 100);
                        }
                    <\/script>
                </body>
            </html>
        `);
            printWindow.document.close();
        });

        // üóëÔ∏è ELIMINAR DESTINO CON SWEETALERT
        document.querySelectorAll('.btn-eliminar').forEach(button => {
            button.addEventListener('click', function () {
                const url = this.getAttribute('data-url');
                const nombre = this.getAttribute('data-nombre');

                Swal.fire({
                    title: '¬øEst√°s seguro?',
                    html: `¬øDeseas eliminar el destino <strong>"${nombre}"</strong>?<br><small>Esta acci√≥n no se puede deshacer.</small>`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: '<i class="fas fa-trash me-1"></i>S√≠, eliminar',
                    cancelButtonText: '<i class="fas fa-times me-1"></i>Cancelar',
                    reverseButtons: true,
                    customClass: {
                        confirmButton: 'btn btn-danger mx-2',
                        cancelButton: 'btn btn-secondary mx-2'
                    },
                    buttonsStyling: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Redirigir directamente a la URL de eliminaci√≥n
                        window.location.href = url;
                    }
                });
            });
        });

        // Funci√≥n para cargar datos en el modal de edici√≥n
        const editarModal = document.getElementById('editarModal');
        const formEditar = document.getElementById('form-editar');

        editarModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;

            // Obtener datos del bot√≥n
            const id = button.getAttribute('data-id');
            const nombre = button.getAttribute('data-nombre');
            const precio = button.getAttribute('data-precio');
            const descripcion = button.getAttribute('data-descripcion');
            const origen = button.getAttribute('data-origen');
            const destino = button.getAttribute('data-destino');
            const fechaSalida = button.getAttribute('data-fecha-salida');
            const fechaRegreso = button.getAttribute('data-fecha-regreso');
            const aerolinea = button.getAttribute('data-aerolinea');

            // Llenar el formulario del modal
            document.getElementById('modal_producto_id').value = id;
            document.getElementById('modal_nombre').value = nombre;
            document.getElementById('modal_precio').value = precio;
            document.getElementById('modal_descripcion').value = descripcion;
            document.getElementById('modal_origen').value = origen;
            document.getElementById('modal_destino').value = destino;
            document.getElementById('modal_fecha_salida').value = fechaSalida;
            document.getElementById('modal_fecha_regreso').value = fechaRegreso;
            document.getElementById('modal_aerolinea').value = aerolinea;

            // CORRECCI√ìN: Usar la nueva funci√≥n editar_producto
            formEditar.action = "{{ url_for('editar_producto', id=0) }}".replace('/0', '/' + id);
        });
    });
</script>

<style>
    .btn:hover {
        transform: translateY(-1px);
        transition: all 0.3s ease;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #17a2b8;
        box-shadow: 0 0 0 0.2rem rgba(23, 162, 184, 0.25);
    }

    .table-hover tbody tr:hover {
        background-color: #e8f4f8 !important;
        transition: all 0.2s ease;
    }

    .text-truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .rounded-top-3 {
        border-top-left-radius: 1rem !important;
        border-top-right-radius: 1rem !important;
    }

    .modal-content {
        border-radius: 1rem;
    }

    .page-link:hover {
        transform: translateY(-1px);
        transition: all 0.3s ease;
    }

    .btn-editar:hover {
        background-color: #007bff;
        color: white;
    }
</style>

{% endblock %}